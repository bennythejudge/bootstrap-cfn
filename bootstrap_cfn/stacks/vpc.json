{
  "VPC" : {
     "Type" : "AWS::EC2::VPC",
     "Properties" : {
        "CidrBlock" : { "Fn::FindInMap" : [ "SubnetConfig", "VPC", "CIDR" ]},
        "EnableDnsSupport" : "true",
        "EnableDnsHostnames" : "true",
        "InstanceTenancy" : "default"
     }
  },

  "SubnetA" : {
    "Type" : "AWS::EC2::Subnet",
    "Properties" : {
      "AvailabilityZone": "eu-west-1a",
      "VpcId" : { "Ref" : "VPC" },
      "CidrBlock" : { "Fn::FindInMap" : [ "SubnetConfig", "VPC", "SubnetA" ]},
      "Tags" : [
        { "Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
        { "Key" : "Network", "Value" : "Public" }
      ]
    }
  },

  "SubnetB" : {
    "Type" : "AWS::EC2::Subnet",
    "Properties" : {
      "AvailabilityZone": "eu-west-1b",
      "VpcId" : { "Ref" : "VPC" },
      "CidrBlock" : { "Fn::FindInMap" : [ "SubnetConfig", "VPC", "SubnetB" ]},
      "Tags" : [
        { "Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
        { "Key" : "Network", "Value" : "Public" }
      ]
    }
  },

  "SubnetC" : {
    "Type" : "AWS::EC2::Subnet",
    "Properties" : {
      "AvailabilityZone": "eu-west-1c",
      "VpcId" : { "Ref" : "VPC" },
      "CidrBlock" : { "Fn::FindInMap" : [ "SubnetConfig", "VPC", "SubnetC" ]},
      "Tags" : [
        { "Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
        { "Key" : "Network", "Value" : "Public" }
      ]
    }
  },

  "InternetGateway" : {
    "Type" : "AWS::EC2::InternetGateway",
    "Properties" : {
      "Tags" : [
        { "Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
        { "Key" : "Network", "Value" : "Public" }
      ]
    }
  },

  "AttachGateway" : {
     "Type" : "AWS::EC2::VPCGatewayAttachment",
     "Properties" : {
       "VpcId" : { "Ref" : "VPC" },
       "InternetGatewayId" : { "Ref" : "InternetGateway" }
     }
  },

  "PublicRouteTable" : {
    "Type" : "AWS::EC2::RouteTable",
    "Properties" : {
      "VpcId" : {"Ref" : "VPC"},
      "Tags" : [
        { "Key" : "Application", "Value" : { "Ref" : "AWS::StackId"} },
        { "Key" : "Network", "Value" : "Public" }
      ]
    }
  },

  "PublicRoute" : {
    "Type" : "AWS::EC2::Route",
    "DependsOn" : "AttachGateway",
    "Properties" : {
      "RouteTableId" : { "Ref" : "PublicRouteTable" },
      "DestinationCidrBlock" : "0.0.0.0/0",
      "GatewayId" : { "Ref" : "InternetGateway" }
    }
  },

  "SubnetRouteTableAssociationA" : {
    "Type" : "AWS::EC2::SubnetRouteTableAssociation",
    "Properties" : {
      "SubnetId" : { "Ref" : "SubnetA" },
      "RouteTableId" : { "Ref" : "PublicRouteTable" }
    }
  },

  "SubnetRouteTableAssociationB" : {
    "Type" : "AWS::EC2::SubnetRouteTableAssociation",
    "Properties" : {
      "SubnetId" : { "Ref" : "SubnetB" },
      "RouteTableId" : { "Ref" : "PublicRouteTable" }
    }
  },

  "SubnetRouteTableAssociationC" : {
    "Type" : "AWS::EC2::SubnetRouteTableAssociation",
    "Properties" : {
      "SubnetId" : { "Ref" : "SubnetC" },
      "RouteTableId" : { "Ref" : "PublicRouteTable" }
    }
  }
}